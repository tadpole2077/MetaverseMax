


<div class="districtImgContainer">
  <div class="innerDistrictImgContainer">
    <img *ngIf="district" src="https://play.mcp3d.com/assets/images/districts/TRX/{{ district.district_id }}.png" class="districtImg" height="240" />
    <div *ngIf="district.active_from" class="slideOutLeft">
      <p aria-live="polite">
        <span>District Opened On:</span>
        <span>{{ district.active_from.substring(0,17) }}</span>
      </p>
      <p aria-live="polite">
        <span>District Data Updated:</span>
        <span>{{ district.last_updateFormated.substring(0,17) }}</span>
      </p>
    </div>
  </div>
</div>

<h3 class="districtHeader">
  District Report : #{{ district.district_id }} {{ district.district_name }}
  <a *ngIf="district.promotion!=null" class="showAd" role="button" (click)="showAd(district.promotion, district.promotion_start, district.promotion_end)"><i class="fas fa-ad adIcon"></i></a>
</h3>


<div class="districtDetailsSection">

  <p *ngIf="!district"><em>Loading...</em></p>

  <div aria-live="polite" class="ownerInfo">
    <div class="ownerImgPos">
      <img *ngIf="district.owner_avatar_id>0" src="https://mcp3d.com/tron/api/image/citizen/{{ district.owner_avatar_id }}" class="ownerImgCol" height="64" />
      <img *ngIf="district.owner_avatar_id==0" src="./images/MysteryOwner.png" class="ownerImgCol" height="50" style="margin-top:0" />
    </div>
    <div class="ownerdata">
      <div>
        Owner:
        <a class="districtOwnerLink nav-link text-dark lineAnim" [routerLink]="['/owner-data']" [queryParams]="{matic: district.owner_matic}" title="{{ district.owner_name }}"><strong>{{ district.owner_name }}</strong></a>
      </div>
      <div>
        District Owner Key:
        <span class="long-text maticLabel">( MATIC ) </span>
        <a class="showMaticKeySmall lineAnim" target="_blank" href="https://explorer-mainnet.maticvigil.com/address/{{ district.owner_matic }}/tokens">Matic Explorer</a>
        <a target="_blank" class="districtOwnerMatic lineAnim" href="https://explorer-mainnet.maticvigil.com/address/{{ district.owner_matic }}/tokens">{{ district.owner_matic.substring(0,15) + '...' }}</a>
      </div>
    </div>
  </div>

  <app-note-modal [hidden]="!this.adShow" (hideAdEvent)="hideAd($event)"></app-note-modal>

  <mat-accordion class="example-headers-align" multi>

    <mat-expansion-panel expanded="true">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>account_balance</mat-icon>
          <span style="margin-left:.2rem">District Tax Graphs</span>
        </mat-panel-title>
        <mat-panel-description>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <div>
        <app-tax-graph #graphConstruct class="taxGraphDistrictConstruct" [graph_type]="CONSTRUCT"></app-tax-graph>
        <app-tax-graph #graphProduce class="taxGraphDistrictProduce" [graph_type]="PRODUCE"></app-tax-graph>

      </div>
    </mat-expansion-panel>


    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>cake</mat-icon>
          <span style="margin-left:.2rem">Local fund and Distribution Graphs</span>
        </mat-panel-title>
        <mat-panel-description>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <div class="fundSection" [hidden]="!district && !district.fundHistory">
        <app-fund-graph #graphFund class="fundGraph"></app-fund-graph>       
        <div style="display:inline-block">
          <app-fund-graph #graphDistribute class="distributeGraph"></app-fund-graph>
          <div>
            <span class="fundDataBlock">Distribution Period: <strong>{{ district.distribution_period }}</strong></span>
          </div>
        </div>
      </div>

    </mat-expansion-panel>

    <mat-expansion-panel expanded="true">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>home</mat-icon>
          <span style="margin-left:.2rem">Summary of Owners, Plot types, Claimed Plots..</span>
        </mat-panel-title>
        <mat-panel-description>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <div class="districtPlotSection" *ngIf="district.owner_matic !=''">
        <div class="districtInfoBlock">
          <div>
            <span class="plotCountFieldA">Total: <strong>{{ district.land_count }}</strong></span>
            <span class="plotCountFieldB">Claimed : <strong>{{ district.plots_claimed }}</strong></span>
            <span class="plotCountFieldC">Owners : <strong>{{ ownerSummary.length }}</strong></span>
          </div>
          <div>
            <span class="plotCountFieldA">Built : <strong>{{ district.building_count }}</strong></span>
            <span class="plotCountFieldB">Empty : <strong>{{ district.plots_claimed - district.building_count }}</strong><span style="font-size:.9em;margin-right:.6rem">(claimed)</span><strong>{{ district.land_count - district.plots_claimed}}</strong><span style="font-size:.9em;">(available)</span></span>
          </div>
        </div>
      </div>

    </mat-expansion-panel>

  </mat-accordion>
</div>


<div [hidden]="ownerSummary && ownerSummary.length" style=""><app-search-district class="searchDistrict" (searchDistrictEvent)="searchDistrict($event)"></app-search-district></div>
  <div class="table-container" [hidden]="!ownerSummary || !ownerSummary.length">
    <div style=""><app-search-district class="searchDistrict" (searchDistrictEvent)="searchDistrict($event)"></app-search-district></div>

    <div fxLayout fxLayoutAlign="center center" style="display:inline-block">
      <mat-form-field fxFlex="30%" class="tableFilter">
        <input matInput type="text" (keyup)="applyFilter($event.target.value)" placeholder="Owner Filter">
      </mat-form-field>
    </div>
    <div class="arrivalCheckboxDiv" fxLayout fxLayoutAlign="center center">
      <mat-checkbox #arrivalsWeek id="arrivalsWeek"
                    fxFlex="30%"
                    class="arrivalCheckbox"                 
                    (change)="filterArrivalsWeek($event)">
        New Arrivals (Prior Week)
      </mat-checkbox>
      <!--<mat-checkbox #arrivalsMonth
                fxFlex="30%"
                class="arrivalCheckboxMonth"
                [(indeterminate)]="indeterminate"
                [labelPosition]="labelPosition"
                (change)="filterArrivalsMonth($event)">
        New Arrivals (Prior Month)
      </mat-checkbox>-->
    </div>

    <table mat-table [dataSource]="dataSourceOwnerSummary" matSort matSortStart="desc" class="table-striped mat-elevation-z8" style="width:100%; display:inline-table">
      <!--table table-striped-->
      <ng-container matColumnDef="owner_nickname">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Owner </th><!-- start="asc"-->
        <td mat-cell *matCellDef="let ownerSummary">
          <i [hidden]="!(ownerSummary.new_owner && !showArrivalMonth)" class="fas fa-plane-arrival arrivalIcon"></i>
          <!--<i [hidden]="!(ownerSummary.new_owner_month && showArrivalMonth)" class="fas fa-plane-arrival arrivalIcon" style=""></i>-->

          <img *ngIf="ownerSummary.owner_avatar_id>0" src="https://mcp3d.com/tron/api/image/citizen/{{ ownerSummary.owner_avatar_id }}" class="ownerImgCol" height="60" />
          <img *ngIf="ownerSummary.owner_avatar_id==0" src="./images/MysteryOwner.png" class="ownerImgCol" height="50" style="margin-top:0" />

          <a class="nav-link text-dark lineAnim" [routerLink]="['/owner-data']" [queryParams]="{matic: ownerSummary.owner_matic}" title="{{ ownerSummary.owner_nickname }}">

            <span *ngIf="ownerSummary.owner_nickname!=''">{{ ownerSummary.owner_nickname }}</span>

            <span class="maticLink" *ngIf="ownerSummary.owner_nickname==''">{{ ownerSummary.owner_matic.substring(0,14) }}</span>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="owned_plots">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span class="long-text">Owned plots</span>
          <span class="short-text">Owned</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.owned_plots }} </td>
      </ng-container>

      <ng-container matColumnDef="energy_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header title="Energy" class="header-count">
          <span class="plotCount">{{ district.energy_count }} x</span>
          <img src="https://play.mcp3d.com/assets/images/buildings/Energy_ThermalPower_LVL1-1.png" height="30" />
          <span class="long-text">Energy</span>
          <span class="short-text">E</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.energy_count }} </td>
      </ng-container>

      <ng-container matColumnDef="industry_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header title="Industry" class="header-count">
          <span class="plotCount">{{ district.industry_count }} x</span>
          <img src="https://play.mcp3d.com/assets/images/buildings/MetalSmelterFactory_V2_LVL1-1.png" height="30" />
          <span class="long-text">Industry</span>
          <span class="short-text">I</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.industry_count }} </td>
      </ng-container>

      <ng-container matColumnDef="production_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header title="Production" class="header-count">
          <span class="plotCount">{{ district.production_count }} x</span>
          <img src="https://play.mcp3d.com/assets/images/buildings/BrickFactory_V2_LVL1-1.png" height="30" />
          <span class="long-text">Production</span><span class="short-text">P</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.production_count }} </td>
      </ng-container>

      <ng-container matColumnDef="office_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header title="Office" class="header-count">
          <span class="plotCount">{{ district.office_count }} x</span>
          <img src="https://play.mcp3d.com/assets/images/buildings/OfficeRing_LVL1-1.png" height="30" />
          <span class="long-text">Office</span>
          <span class="short-text">O</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.office_count }} </td>
      </ng-container>

      <ng-container matColumnDef="residential_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header title="Residential" class="header-count">
          <span class="plotCount">{{ district.residential_count }} x</span>
          <img src="https://play.mcp3d.com/assets/images/buildings/Residential3_LVL1-1.png" height="30" />
          <span class="long-text">Residential</span>
          <span class="short-text">R</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.residential_count }} </td>
      </ng-container>

      <ng-container matColumnDef="poi_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="header-count">
          <span class="plotCount">{{ district.poi_count }} x</span>
          <img src="./images/OfficeMonument.PNG" height="30" />
          <span class="long-text">POI</span>
          <span class="short-text">POI</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.poi_count }} </td>
      </ng-container>

      <ng-container matColumnDef="commercial_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header title="Commercial" class="header-count">
          <span class="plotCount">{{ district.commercial_count }} x</span>
          <img src="https://play.mcp3d.com/assets/images/buildings/Blockmart_V2_LVL1-1.png" height="30" />
          <span class="long-text">Commercial</span>
          <span class="short-text">C</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.commercial_count }} </td>
      </ng-container>

      <ng-container matColumnDef="municipal_count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header title="Municipal" class="header-count">
          <span class="plotCount">{{ district.municipal_count }} x</span>
          <img src="https://play.mcp3d.com/assets/images/buildings/Hospital_V2_LVL1-1.png" height="30" />
          <span class="long-text">Municipal</span>
          <span class="short-text">M</span>
        </th>
        <td mat-cell *matCellDef="let ownerSummary">  {{ ownerSummary.municipal_count }} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumnsOwners; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsOwners;"></tr>
    </table>

  </div>
